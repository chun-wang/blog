---
title: 布隆过滤器(BloomFilter)
category:
  - Develop
tags:
  - BloomFilter
  - 大数据
toc: false
date: 2019-01-26 21:04:53
---

#### 背景

布隆过滤器是用来判断一个元素是否出现在给定集合中的重要工具，具有快速，比哈希表更节省空间等优点，而缺点在于有一定的误识别率（false-positive，假阳性），亦即，它可能会把不是集合内的元素判定为存在于集合内，不过这样的概率相当小，在大部分的生产环境中是可以接受的；

#### 常见问题

- 编辑器软件需要检查一个英语单词是否拼写正确
- 广告、新闻推荐时判断一篇文章是否已经推荐过
- 邮箱垃圾邮件过滤

#### 常规思路

- 数组
- 链表
- 树、平衡二叉树、Trie
- Map (红黑树)
- 哈希表

对于简单的少量数据处理，上述数据结构基本能够满足要求。但随着互联网不断的发展，带给我们最大的挑战就是当数据量呈现爆发增长时，如何在效率、存储上获取最优的解决方案。设想如果需要处理、匹配的数据量达到百万、千万时，不论是常规的Map还是性能优异的Hash表，都将面对检索性能极速下降、存储量持续上升的问题。这时候我们就需要用到**布隆过滤器(BloomFilter)**。

#### 原理

如下图所示，S集合中有n个元素，利用k个哈希函数，将S中的每个元素映射到一个长度为m的位（bit）数组B中不同的位置上，这些位置上的二进制数均置为1，如果待检测的元素经过这k个哈希函数的映射后，发现其k个位置上的二进制数不全是1，那么这个元素一定不在集合S中，反之，该元素可能是S中的某一个元素（参考1）；

![](http://qiniu.springfavor.cn/img/1609ba689562e6e1.jpeg)

#### 最优判率

和判率相关的两个点：

1. 哈希函数个数(k);
2. 容器数组长度(m);

为了估算出k和m的值，在构造一个布隆过滤器时，需要传入两个参数，即可以接受的误判率fpp和元素总个数n（不一定完全精确）。至于参数估计的方法，有兴趣的同学可以参考维基英文页面，下面直接给出公式：![](http://qiniu.springfavor.cn/img/1609ba6895bdeb30.jpeg)

1. 哈希函数的要求尽量满足平均分布，这样既降低误判发生的概率，又可以充分利用bit数组的空间；
2. 根据论文《Less Hashing, Same Performance: Building a Better Bloom Filter》提出的一个技巧，可以用2个哈希函数来模拟k个哈希函数，即gi(x) = h1(x) + ih2(x) ，其中0<=i<=k-1； 
3. 在吴军博士的《数学之美》一书中展示了不同情况下的误判率，例如，假定一个元素用16位比特，8个哈希函数，那么假阳性的概率是万分之五，这已经相当小了。